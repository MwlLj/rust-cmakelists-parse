CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT (iotas)

SET (CMAKE_INSTALL_PREFIX ${PROJECT_SOURCE_DIR})
SET (CMAKE_PREFIX_PATH ${PROJECT_SOURCE_DIR})

IF (CMAKE_SYSTEM_NAME MATCHES "Linux")
	MESSAGE(STATUS "current platform: Linux")
	SET (OS "LINUX")
	IF (USE_32BIT)
		SET (FILE_PREFIX "")
		SET (OUTPUT_PATH_SUFFIX "linux32")
		SET (WITH_64BIT FALSE)
	ELSE ()
		SET (FILE_PREFIX "64")
		SET (OUTPUT_PATH_SUFFIX "linux64")	
		SET (WITH_64BIT TRUE)
	ENDIF()
ELSEIF (CMAKE_SYSTEM_NAME MATCHES "Windows")  
	MESSAGE(STATUS "current platform: Windows")
	SET (OS "WINDOWS")
	SET (VS_WIN32 "VC/bin/cl.exe")
	SET (VS_WIN64 "VC/bin/x86_amd64/cl.exe")
	IF (DEFINED ENV{VS100COMNTOOLS})
		STRING (REPLACE "\\" "/" VS100COMNTOOLS $ENV{VS100COMNTOOLS})
		STRING (REPLACE "/Common7/Tools/" "" VS2010_COMPILER ${VS100COMNTOOLS})
	ENDIF ()
	IF (DEFINED ENV{VS140COMNTOOLS})
		STRING (REPLACE "\\" "/" VS140COMNTOOLS $ENV{VS140COMNTOOLS})
		STRING (REPLACE "/Common7/Tools/" "" VS2015_COMPILER ${VS140COMNTOOLS})
	ENDIF ()
ELSE ()
	MESSAGE(STATUS "other platform: ${CMAKE_SYSTEM_NAME}") 
ENDIF ()

IF (${OS} STREQUAL "LINUX")	
	IF (${PLATFORM_TYPE} MATCHES "arm")
		SET(OUTPUT_PATH ${PLATFORM_TYPE}_${PLATFORM_NAME})
	ELSE()
		  IF (WITH_64BIT)
        SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -m64")
        SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -m64")
        SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -m64")
      ELSE()
        #SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -m32") 
        #SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -m32")  
        #SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -m32")     
      ENDIF()
		SET (OUTPUT_PATH gcc_${OUTPUT_PATH_SUFFIX})
	ENDIF()
		  
	IF (${CMAKE_BUILD_TYPE} STREQUAL "Debug")
		SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}  -g -Wall -fPIC -Wl,--whole-archive -lpthread  -Wl,--no-whole-archive -Wl,-rpath=./ -lc -ldl")
		SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -Wall -std=c++0x -fPIC -Wl,--whole-archive -lpthread  -Wl,--no-whole-archive  -Wl,-rpath=./ -lc -ldl")
		SET (OUTPUT_SUB_PATH "debug")	
	ELSE()
		SET (OUTPUT_SUB_PATH "release")
		SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}  -O3 -Os -fPIC -Wl,--whole-archive -lpthread  -Wl,--no-whole-archive  -Wl,-rpath=./ -lc -ldl")
		SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x -O2 -Os -fPIC -Wl,--whole-archive -lpthread  -Wl,--no-whole-archive  -Wl,-rpath=./ -lc -ldl")
	ENDIF()	
		
ELSEIF (${OS} STREQUAL "WINDOWS")
	IF (${CMAKE_C_COMPILER} STREQUAL ${VS2010_COMPILER}/${VS_WIN32})
		SET (OUTPUT_PATH "vs2010_win32")
		SET (FILE_PREFIX "")
		SET (WITH_64BIT FALSE)
	ELSEIF (${CMAKE_C_COMPILER} STREQUAL ${VS2010_COMPILER}/${VS_WIN64})
		SET (OUTPUT_PATH "vs2010_win64")
		SET (FILE_PREFIX "64")
		SET (WITH_64BIT TRUE)
	ELSEIF (${CMAKE_C_COMPILER} STREQUAL ${VS2015_COMPILER}/${VS_WIN32})
		SET (OUTPUT_PATH "vs2015_win32")
		SET (FILE_PREFIX "")
		SET (WITH_64BIT FALSE)
	ELSEIF (${CMAKE_C_COMPILER} STREQUAL ${VS2015_COMPILER}/${VS_WIN64})
		SET (OUTPUT_PATH "vs2015_win64")
		SET (FILE_PREFIX "64")
		SET (WITH_64BIT TRUE)
	ENDIF()
ELSE ()
	SET (OUTPUT_PATH "unknown")
ENDIF ()

IF (NOT DEFINED CMAKE_DEBUG_POSTFIX)
	SET (CMAKE_DEBUG_POSTFIX "_d")
ENDIF ()

SET (CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/01bin/${OUTPUT_PATH}/${OUTPUT_SUB_PATH})
SET (CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/01bin/${OUTPUT_PATH}/${OUTPUT_SUB_PATH})
SET (CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/02lib/${OUTPUT_PATH}/${OUTPUT_SUB_PATH})
SET (EXECUTABLE_OUTPUT_DIR ${PROJECT_SOURCE_DIR}/01bin/${OUTPUT_PATH}/${OUTPUT_SUB_PATH})
#Install path
SET (INSTALL_BIN_DIR ${CMAKE_INSTALL_PREFIX}/01bin/${OUTPUT_PATH})
SET (INSTALL_LIB_DIR ${CMAKE_INSTALL_PREFIX}/02lib/${OUTPUT_PATH})
#Complier path
SET (HEADER_DIR ${PROJECT_SOURCE_DIR}/03implement/00header)
SET (THIRD_HEADER_DIR ${PROJECT_SOURCE_DIR}/03implement/00header/thirdparties)
SET (FRAMEWORK_HEADER_DIR ${PROJECT_SOURCE_DIR}/03implement/00header/framework)

SET (THIRD_STATIC_LIB_DIR ${PROJECT_SOURCE_DIR}/02lib/${OUTPUT_PATH}/third_lib)
SET (THIRD_SHARED_LIB_DIR ${PROJECT_SOURCE_DIR}/01bin/${OUTPUT_PATH}/third_dll)

#Link directories
SET (LINK_LIBRARIES_DIR
${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}
${THIRD_STATIC_LIB_DIR}/framework
${THIRD_STATIC_LIB_DIR}/cbbparties
${THIRD_STATIC_LIB_DIR}/jsoncpp
${THIRD_STATIC_LIB_DIR}/log4cplus
${THIRD_STATIC_LIB_DIR}/mosquitto
${THIRD_STATIC_LIB_DIR}/mysqlwrap
${THIRD_STATIC_LIB_DIR}/pthread
${THIRD_STATIC_LIB_DIR}/sqlite3
${THIRD_STATIC_LIB_DIR}/zookeeper
${THIRD_STATIC_LIB_DIR}/libjpeg
${THIRD_STATIC_LIB_DIR}/curl
${THIRD_STATIC_LIB_DIR}/openssl
${THIRD_STATIC_LIB_DIR}/mysql
${THIRD_STATIC_LIB_DIR}/libevent
${THIRD_STATIC_LIB_DIR}/anywhere_net
${THIRD_STATIC_LIB_DIR}/uuid
${THIRD_STATIC_LIB_DIR}/gtest
${THIRD_STATIC_LIB_DIR}/boost
${THIRD_STATIC_LIB_DIR}/live555
${THIRD_STATIC_LIB_DIR}/mysql
${THIRD_STATIC_LIB_DIR}/mysqlwrap
${THIRD_STATIC_LIB_DIR}/mimetic
${THIRD_STATIC_LIB_DIR}/rabbitmq
${THIRD_STATIC_LIB_DIR}/zlib
)

IF (${OS} STREQUAL "LINUX")	
	SET (LINK_LIBRARIES_DIR
			${LINK_LIBRARIES_DIR}
			${THIRD_SHARED_LIB_DIR}/hk/net/
			${THIRD_SHARED_LIB_DIR}/dh/net/
		)
ELSEIF (${OS} STREQUAL "WINDOWS")
	SET (LINK_LIBRARIES_DIR
			${LINK_LIBRARIES_DIR}
			${THIRD_STATIC_LIB_DIR}/hk/net/
			${THIRD_STATIC_LIB_DIR}/dh/net/
		)
ENDIF ()

INCLUDE (09compile/ProjectList.cmake)
